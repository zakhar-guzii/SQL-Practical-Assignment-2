| EXPLAIN |
| :--- |
| -&gt; Table scan on &lt;temporary&gt;  \(actual time=3591..3591 rows=25 loops=1\)<br/>    -&gt; Aggregate using temporary table  \(actual time=3591..3591 rows=25 loops=1\)<br/>        -&gt; Nested loop left join  \(cost=13.8e+6 rows=0\) \(actual time=3590..3590 rows=2541 loops=1\)<br/>            -&gt; Table scan on cs  \(cost=1.34e+6..1.34e+6 rows=0\) \(actual time=3094..3094 rows=25 loops=1\)<br/>                -&gt; Materialize CTE category\_stats  \(cost=1.34e+6..1.34e+6 rows=0\) \(actual time=3094..3094 rows=25 loops=1\)<br/>                    -&gt; Group aggregate: sum\(\(case when \(year\(p.published\_at\) = 2024\) then 1 else 0 end\)\), sum\(\(case when \(year\(p.published\_at\) = 2025\) then 1 else 0 end\)\), count\(distinct \(case when \(year\(p.published\_at\) = 2024\) then p.author\_id end\)\), count\(distinct \(case when \(year\(p.published\_at\) = 2025\) then p.author\_id end\)\), avg\(\(case when \(year\(p.published\_at\) = 2024\) then coalesce\(pc.comment\_count,0\) end\)\), avg\(\(case when \(year\(p.published\_at\) = 2025\) then coalesce\(pc.comment\_count,0\) end\)\)  \(cost=1.34e+6 rows=0\) \(actual time=1677..3094 rows=25 loops=1\)<br/>                        -&gt; Nested loop left join  \(cost=1.34e+6 rows=0\) \(actual time=1612..2978 rows=360655 loops=1\)<br/>                            -&gt; Filter: \(\(p.published\_at &gt;= TIMESTAMP'2024-01-01 00:00:00'\) and \(p.published\_at &lt; TIMESTAMP'2026-01-01 00:00:00'\)\)  \(cost=100735 rows=497497\) \(actual time=54.9..962 rows=360655 loops=1\)<br/>                                -&gt; Index scan on p using idx\_posts\_category\_published\_at  \(cost=100735 rows=994994\) \(actual time=3.02..936 rows=1e+6 loops=1\)<br/>                            -&gt; Index lookup on pc using &lt;auto\_key0&gt; \(post\_id=p.post\_id\)  \(cost=0.25..2.5 rows=10\) \(actual time=0.00546..0.00552 rows=1 loops=360655\)<br/>                                -&gt; Materialize CTE post\_comments  \(cost=0..0 rows=0\) \(actual time=1557..1557 rows=360655 loops=1\)<br/>                                    -&gt; Table scan on &lt;temporary&gt;  \(actual time=1319..1348 rows=360655 loops=1\)<br/>                                        -&gt; Aggregate using temporary table  \(actual time=1319..1319 rows=360654 loops=1\)<br/>                                            -&gt; Nested loop left join  \(cost=778883 rows=1.8e+6\) \(actual time=0.124..660 rows=1.44e+6 loops=1\)<br/>                                                -&gt; Filter: \(\(p.published\_at &gt;= TIMESTAMP'2024-01-01 00:00:00'\) and \(p.published\_at &lt; TIMESTAMP'2026-01-01 00:00:00'\)\)  \(cost=100107 rows=497497\) \(actual time=0.0735..47.6 rows=360655 loops=1\)<br/>                                                    -&gt; Covering index range scan on p using idx\_posts\_published\_at over \('2024-01-01 00:00:00' &lt;= published\_at &lt; '2026-01-01 00:00:00'\)  \(cost=100107 rows=497497\) \(actual time=0.0722..31.8 rows=360655 loops=1\)<br/>                                                -&gt; Covering index lookup on c using idx\_comments\_post\_id \(post\_id=p.post\_id\)  \(cost=1 rows=3.62\) \(actual time=0.00131..0.00155 rows=4 loops=360655\)<br/>            -&gt; Index lookup on pd using &lt;auto\_key0&gt; \(category=cs.category\)  \(cost=0.25..2.5 rows=10\) \(actual time=19.8..19.9 rows=102 loops=25\)<br/>                -&gt; Materialize CTE post\_diffs  \(cost=0..0 rows=0\) \(actual time=496..496 rows=2541 loops=1\)<br/>                    -&gt; Table scan on &lt;temporary&gt;  \(actual time=495..495 rows=2541 loops=1\)<br/>                        -&gt; Aggregate using temporary table  \(actual time=495..495 rows=2541 loops=1\)<br/>                            -&gt; Filter: \(t.next\_published\_at is not null\)  \(cost=99499..55971 rows=447747\) \(actual time=473..493 rows=2550 loops=1\)<br/>                                -&gt; Table scan on t  \(cost=99499..111939 rows=994994\) \(actual time=473..488 rows=360655 loops=1\)<br/>                                    -&gt; Materialize  \(cost=99499..99499 rows=994994\) \(actual time=473..473 rows=360655 loops=1\)<br/>                                        -&gt; Window aggregate with buffering: lead\(posts.published\_at\) OVER \(PARTITION BY posts.author\_id,posts.category ORDER BY posts.published\_at \)   \(cost=0 rows=994994\) \(actual time=145..391 rows=360655 loops=1\)<br/>                                            -&gt; Sort: posts.author\_id, posts.category, posts.published\_at  \(cost=100735 rows=994994\) \(actual time=145..152 rows=360655 loops=1\)<br/>                                                -&gt; Filter: \(\(posts.published\_at &gt;= TIMESTAMP'2024-01-01 00:00:00'\) and \(posts.published\_at &lt; TIMESTAMP'2026-01-01 00:00:00'\)\)  \(cost=100735 rows=994994\) \(actual time=0.0544..113 rows=360655 loops=1\)<br/>                                                    -&gt; Covering index scan on posts using idx\_posts\_author\_category\_published  \(cost=100735 rows=994994\) \(actual time=0.0529..86.4 rows=1e+6 loops=1\)<br/> |
